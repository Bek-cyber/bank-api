# Bank API — Transactional Backend (Spring Boot)

## Описание

**Bank API** — backend-сервис, имитирующий банковскую систему счетов и транзакций.

Проект сфокусирован на:
- корректной работе с деньгами,
- консистентности данных,
- обработке конкурентных запросов,
- idempotency и отказоустойчивости.

---

## Цель проекта

Проект используется для:
- демонстрации архитектурных решений backend-систем,
- практики работы с транзакциями, concurrency и consistency.

---

## Технологии

- Java 21
- Spring Boot 3.2.5
- Spring Data JPA (Hibernate)
- PostgreSQL
- Flyway
- Lombok
- Gradle

---

## Архитектура проекта

```text
com.project.bankapi
├── controller  
├── domain
│   ├── entity       
│   ├── repository   
│   └── enums
├── dto
│   ├── request       
│   └── response      
├── service          
├── exception        
└── BankApiApplication
```
---

## Реализованный функционал

- Создание банковских счетов
- Получение информации о счёте
- Пополнение баланса
- Списание средств
- Атомарные переводы между счетами
- История транзакций с пагинацией
- Health-endpoint для мониторинга

---

## Защита от race conditions

Проект защищён от **race conditions** (состояний гонки), возникающих при одновременных запросах к одному счёту.

### Используемые механизмы:

- **Optimistic locking** (@Version) на уровне JPA
- Транзакционность (@Transactional)
- Контролируемый retry при конфликтах обновления

### Результат:
- 
- невозможность «создания денег из воздуха»
- корректная обработка конкурентных списаний и переводов
- отсутствие блокировок в стандартных REST-сценариях

---

## Exactly-once семантика (Idempotency)

Все write-операции поддерживают **exactly-once семантику**.

### Как реализовано:

- Клиент передаёт заголовок **Idempotency-Key**
- Ключ + endpoint сохраняются в БД
- При повторном запросе возвращается сохранённый результат

### Дополнительно:

- Реализован **TTL (24 часа)** для idempotency-ключей
- Автоматическая очистка устаревших ключей через scheduled-задачу

---

## Работа с БД и производительность

- Схема БД управляется через **Flyway**
- Hibernate работает в режиме **ddl-auto=validate**
- Добавлены индексы под реальные бизнес-запросы:
  - история транзакций по счёту
  - idempotency-ключи

---

## Concurrency-стратегия

- Для REST-операций используется **optimistic locking**
- Это позволяет избежать блокировок и дедлоков
- При высокой конкуренции предусмотрена возможность
точечного перехода на **pessimistic locking (SELECT FOR UPDATE)**

